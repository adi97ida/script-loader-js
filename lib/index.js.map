{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["export interface LoaderAugmentedWindow extends Window {\n    fvStudioScriptLoader: any;\n}\n\ndeclare let window: LoaderAugmentedWindow;\ninterface LoadStylesheetOptions {\n    prepend: boolean;\n    attributes?: Record<string, string>;\n}\n\ninterface PreloadOptions {\n    prefetch: boolean;\n}\n\ninterface LoadScriptOptions {\n    async: boolean;\n    attributes: Record<string, string>;\n}\n\ninterface LegacyHTMLScriptElement extends HTMLScriptElement {\n    // `onreadystatechange` is needed to support legacy IE\n    onreadystatechange(this: HTMLElement, event: Event): any;\n}\n\nclass Loader {\n    static canSupportRel(rel: string): boolean {\n        const link = document.createElement('link');\n\n        return !!(\n            link.relList &&\n            link.relList.supports &&\n            link.relList.supports(rel)\n        );\n    }\n\n    static loadStylesheet(src: string, options?: LoadStylesheetOptions): Promise<void> {\n        if (!this._stylesheets[src]) {\n            this._stylesheets[src] = new Promise((resolve, reject) => {\n                const stylesheet = document.createElement('link');\n                const { prepend = false, attributes = {} } = options || {};\n\n                Object.keys(attributes)\n                    .forEach(key => {\n                        stylesheet.setAttribute(key, attributes[key]);\n                    });\n\n                stylesheet.onload = () => resolve();\n                stylesheet.onerror = event => {\n                    delete this._stylesheets[src];\n                    reject(event);\n                };\n                stylesheet.rel = 'stylesheet';\n                stylesheet.href = src;\n\n                if (prepend && document.head.children[0]) {\n                    document.head.insertBefore(stylesheet, document.head.children[0]);\n                } else {\n                    document.head.appendChild(stylesheet);\n                }\n            });\n        }\n\n        return this._stylesheets[src];\n    }\n\n    static loadStylesheets(urls: string[], options?: LoadStylesheetOptions): Promise<void> {\n        return Promise.all(urls.map(url => this.loadStylesheet(url, options)))\n            .then(() => undefined);\n    }\n\n    static preloadStylesheet(url: string, options?: PreloadOptions): Promise<void> {\n        if (!this._preloadedStylesheets[url]) {\n            this._preloadedStylesheets[url] = new Promise((resolve, reject) => {\n                const { prefetch = false } = options || {};\n                const rel = prefetch ? 'prefetch' : 'preload';\n\n                if (this.canSupportRel(rel)) {\n                    const preloadedStylesheet = document.createElement('link');\n\n                    preloadedStylesheet.as = 'style';\n                    preloadedStylesheet.rel = prefetch ? 'prefetch' : 'preload';\n                    preloadedStylesheet.href = url;\n\n                    preloadedStylesheet.onload = () => {\n                        resolve();\n                    };\n\n                    preloadedStylesheet.onerror = event => {\n                        delete this._preloadedStylesheets[url];\n                        reject(event);\n                    };\n\n                    document.head.appendChild(preloadedStylesheet);\n                } else {\n                    fetch(url, {\n                        credentials: 'omit',\n                        headers: { Accept: 'text/css' },\n                    })\n                        .then(() => resolve())\n                        .catch(reject);\n                }\n            });\n        }\n\n        return this._preloadedStylesheets[url];\n    }\n\n    static preloadStylesheets(urls: string[], options?: PreloadOptions): Promise<void> {\n        return Promise.all(urls.map(url => this.preloadStylesheet(url, options)))\n            .then(() => undefined);\n    }\n\n    static loadScript(src: string, options?: LoadScriptOptions): Promise<void> {\n        if (!this._scripts[src]) {\n            this._scripts[src] = new Promise((resolve, reject) => {\n                const script = document.createElement('script') as LegacyHTMLScriptElement;\n                const { async = false, attributes = {} } = options || {};\n\n                Object.keys(attributes)\n                    .forEach(key => {\n                        script.setAttribute(key, attributes[key]);\n                    });\n\n                script.onload = () => resolve();\n                script.onreadystatechange = () => resolve();\n                script.onerror = event => {\n                    delete this._scripts[src];\n                    reject(event);\n                };\n                script.async = async;\n                script.src = src;\n\n                document.body.appendChild(script);\n            });\n        }\n\n        return this._scripts[src];\n    }\n\n    static loadScripts(urls: string[], options?: LoadScriptOptions): Promise<void> {\n        return Promise.all(urls.map(url => this.loadScript(url, options)))\n            .then(() => undefined);\n    }\n\n    static preloadScript(url: string, options?: PreloadOptions): Promise<void> {\n        if (!this._preloadedScripts[url]) {\n            this._preloadedScripts[url] = new Promise((resolve, reject) => {\n                const { prefetch = false } = options || {};\n                const rel = prefetch ? 'prefetch' : 'preload';\n\n                if (this.canSupportRel(rel)) {\n                    const preloadedScript = document.createElement('link');\n\n                    preloadedScript.as = 'script';\n                    preloadedScript.rel = rel;\n                    preloadedScript.href = url;\n\n                    preloadedScript.onload = () => {\n                        resolve();\n                    };\n\n                    preloadedScript.onerror = () => {\n                        delete this._preloadedScripts[url];\n                        reject();\n                    };\n\n                    document.head.appendChild(preloadedScript);\n                } else {\n                    fetch(url, {\n                        credentials: 'omit',\n                        headers: { Accept: 'application/javascript' },\n                    })\n                        .then(() => resolve())\n                        .catch(reject);\n                }\n            });\n        }\n\n        return this._preloadedScripts[url];\n    }\n\n    static preloadScripts(urls: string[], options?: PreloadOptions): Promise<void> {\n        return Promise.all(urls.map(url => this.preloadScript(url, options)))\n            .then(() => undefined);\n    }\n    private static _stylesheets: Record<string, Promise<void>> = {};\n    private static _preloadedStylesheets: Record<string, Promise<void>> = {};\n    private static _scripts: Record<string, Promise<void>> = {};\n    private static _preloadedScripts: Record<string, Promise<void>> = {};\n}\n\nwindow.fvStudioScriptLoader = Loader;\n"]}